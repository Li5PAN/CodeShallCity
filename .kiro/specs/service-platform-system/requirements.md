# 需求文档

## 简介

本文档规定了基于Spring Boot和Vue.js构建的服务平台系统的需求。该平台支持三种不同的用户角色（普通用户、服务提供者、管理员）与文章、服务、需求和订单进行交互。系统遵循CSDN风格的UI/UX模式，提供全面的内容管理、交易处理和管理监督功能。

## 术语表

- **平台**: 由Spring Boot后端和Vue.js前端组成的服务平台系统
- **普通用户**: 具有基本访问权限的注册平台成员
- **服务提供者**: 具有提供者认证资格并可以发布服务的注册平台成员
- **管理员**: 具有完整系统管理权限的平台管理员
- **文章**: 在论坛模块中发布的用户生成内容
- **需求**: 用户发布的服务需求
- **服务**: 提供者提供的可供购买的服务列表
- **订单**: 当普通用户购买服务时创建的交易记录
- **申诉**: 普通用户针对不满意订单提交的正式投诉
- **创作中心**: 用于发布文章、需求和服务的内容创作界面
- **详情页**: 显示文章、需求、服务或订单完整信息的单独页面视图
- **认证**: 普通用户成为服务提供者的审批流程
- **交易**: 订单从创建到完成或失败的完整生命周期

## 需求

### 需求1：用户认证和角色管理

**用户故事：** 作为平台管理员，我希望管理用户角色和权限，以便用户根据其角色拥有适当的访问级别。

#### 验收标准

1. 平台应当支持三种不同的用户角色：普通用户、服务提供者和管理员
2. 当用户注册时，平台应当默认分配普通用户角色
3. 当普通用户申请服务提供者认证时，平台应当创建认证请求供管理员审核
4. 当管理员批准认证请求时，平台应当将普通用户角色升级为服务提供者
5. 平台应当对所有受保护资源实施基于角色的访问控制
6. 当用户尝试访问资源时，平台应当验证用户具有所需的角色权限

### 需求2：文章管理

**用户故事：** 作为普通用户，我希望创建和管理文章，以便与平台社区分享知识。

#### 验收标准

1. 平台应当在创作中心提供文章创建界面
2. 当普通用户创建文章时，平台应当将文章保存并将该用户设为作者
3. 当普通用户查看自己的文章时，平台应当显示编辑和删除选项
4. 当普通用户查看其他用户的文章时，平台应当以只读模式显示文章
5. 平台应当在列表视图中显示文章的标题、作者、发布时间和互动指标
6. 当普通用户点击文章时，平台应当在单独视图中打开文章详情页
7. 详情页应当在右上角显示关闭按钮（X）
8. 当普通用户点击关闭按钮时，平台应当关闭详情页并返回上一个视图

### 需求3：需求管理

**用户故事：** 作为普通用户，我希望发布和管理需求，以便找到能够满足我需求的服务提供者。

#### 验收标准

1. 平台应当在创作中心提供需求创建界面
2. 当普通用户创建需求时，平台应当将需求保存并将该用户设为需求方
3. 当普通用户查看自己的需求时，平台应当显示编辑和删除选项
4. 当普通用户第二次编辑自己的需求时，平台应当以详情页查看模式显示需求
5. 当普通用户查看其他用户的需求时，平台应当以只读详情页模式显示需求
6. 平台应当在列表视图中显示需求的标题、需求方、发布时间和状态
7. 需求详情页应当在右上角包含关闭按钮（X）

### 需求4：服务管理

**用户故事：** 作为服务提供者，我希望发布和管理服务，以便普通用户可以发现并购买我的服务。

#### 验收标准

1. 当用户具有服务提供者角色时，平台应当在创作中心提供服务创建界面
2. 当服务提供者创建服务时，平台应当将服务保存为待审批状态
3. 当管理员批准服务时，平台应当将服务状态更改为活跃并使其对普通用户可见
4. 当服务提供者查看自己的服务时，平台应当显示编辑和删除选项
5. 当服务提供者第二次编辑自己的服务时，平台应当以详情页查看模式显示服务
6. 当普通用户查看服务时，平台应当以只读详情页模式显示服务并提供购买选项
7. 平台应当在列表视图中显示服务的标题、提供者、价格、类别和评分
8. 服务详情页应当在右上角包含关闭按钮（X）

### 需求5：订单交易处理

**用户故事：** 作为普通用户，我希望购买服务并跟踪我的订单，以便获得我需要的服务。

#### 验收标准

1. 当普通用户购买服务时，平台应当创建状态为"待处理"的订单
2. 订单应当记录服务名称、购买时间、服务提供者名称和买家名称
3. 当订单创建时，平台应当向服务提供者发送通知
4. 平台应当提供订单管理界面，显示所有普通用户订单
5. 当普通用户查看订单时，平台应当在详情页中显示订单详情
6. 平台应当通过以下状态跟踪订单状态：待处理、进行中、已完成、已失败
7. 当订单状态变更时，平台应当向普通用户和服务提供者发送通知

### 需求6：订单申诉系统

**用户故事：** 作为普通用户，我希望对不满意的订单提出申诉，以便寻求服务问题的解决方案。

#### 验收标准

1. 当订单状态为已完成时，平台应当为买家显示申诉按钮
2. 当普通用户点击申诉按钮时，平台应当打开模态表单
3. 申诉表单应当显示只读字段：订单名称、购买时间、服务提供者名称、买家名称
4. 申诉表单应当提供输入字段：申诉原因、申诉类型和支持材料
5. 平台应当支持两种申诉类型："服务不达标"和"未按时交付"
6. 当普通用户提交申诉时，平台应当创建状态为"待处理"的申诉记录
7. 当申诉创建时，平台应当向管理员用户发送通知
8. 平台应当防止对同一订单提交多次申诉

### 需求7：管理员申诉解决

**用户故事：** 作为管理员，我希望审核和解决订单申诉，以便确保平台上的公平交易。

#### 验收标准

1. 平台应当为管理员用户提供申诉管理界面
2. 申诉界面应当显示所有待处理申诉及订单详情和申诉信息
3. 当管理员查看申诉时，平台应当显示完整的申诉详情，包括支持材料
4. 平台应当提供两种解决选项："申诉成功"和"申诉失败"
5. 当管理员选择"申诉成功"时，平台应当将订单状态标记为已失败
6. 当管理员选择"申诉失败"时，平台应当拒绝申诉并保持订单状态
7. 当申诉解决时，平台应当向普通用户和服务提供者发送通知
8. 平台应当记录管理员决定和时间戳以供审计

### 需求8：用户互动功能

**用户故事：** 作为普通用户，我希望通过点赞、收藏和浏览历史与文章互动，以便与我认为有价值的内容互动。

#### 验收标准

1. 当普通用户查看文章时，平台应当显示点赞和收藏按钮
2. 当普通用户点击点赞按钮时，平台应当增加文章点赞数
3. 当普通用户点击收藏按钮时，平台应当将文章添加到用户的收藏集合
4. 平台应当提供收藏管理界面，显示所有已收藏的文章
5. 当普通用户查看文章时，平台应当在用户的浏览历史中记录该查看
6. 平台应当提供浏览历史界面，显示最近查看的文章及时间戳
7. 平台应当允许普通用户从收藏和浏览历史中删除项目

### 需求9：订阅系统

**用户故事：** 作为普通用户，我希望订阅服务提供者或内容创作者，以便及时了解他们的新内容。

#### 验收标准

1. 当普通用户查看其他用户的个人资料时，平台应当显示订阅按钮
2. 当普通用户点击订阅按钮时，平台应当创建订阅关系
3. 平台应当提供订阅管理界面，显示所有已订阅的用户
4. 当被订阅用户发布新内容时，平台应当向订阅者发送通知
5. 平台应当允许普通用户取消任何订阅
6. 平台应当在用户个人资料上显示订阅数量

### 需求10：通知系统

**用户故事：** 作为普通用户，我希望接收有关平台活动的通知，以便及时了解相关事件。

#### 验收标准

1. 平台应当提供可从所有页面访问的通知中心
2. 当触发通知的事件发生时，平台应当为相关用户创建通知记录
3. 平台应当在通知中心图标中显示未读通知数量
4. 当普通用户打开通知中心时，平台应当按时间戳排序显示所有通知
5. 平台应当支持通知类型：订单更新、申诉更新、订阅的新内容、系统公告
6. 当普通用户点击通知时，平台应当将其标记为已读并导航到相关内容
7. 平台应当允许普通用户将所有通知标记为已读或删除通知

### 需求11：管理员仪表板和分析

**用户故事：** 作为管理员，我希望查看平台统计数据和分析，以便监控平台健康状况并做出明智决策。

#### 验收标准

1. 平台应当提供显示关键指标的管理员仪表板
2. 仪表板应当显示折线图，显示一段时间内的订单交易统计
3. 仪表板应当显示成功订单的总数
4. 仪表板应当显示失败订单的总数
5. 仪表板应当默认显示最近七天的数据
6. 仪表板应当显示类别排名，显示最受欢迎的服务类别
7. 当管理员选择不同的时间范围时，平台应当相应更新所有仪表板指标
8. 平台应当每5分钟刷新一次仪表板数据

### 需求12：管理员用户管理

**用户故事：** 作为管理员，我希望管理平台用户，以便维护平台安全和用户质量。

#### 验收标准

1. 平台应当为管理员用户提供用户管理界面
2. 用户管理界面应当显示所有注册用户及其角色和状态
3. 平台应当允许管理员按用户名、电子邮件或角色搜索用户
4. 平台应当允许管理员查看详细的用户信息，包括注册日期和活动历史
5. 平台应当允许管理员暂停或激活用户账户
6. 当管理员暂停用户账户时，平台应当阻止该用户登录
7. 平台应当允许管理员手动更改用户角色
8. 平台应当记录所有管理员操作以供审计

### 需求13：服务提供者认证审核

**用户故事：** 作为管理员，我希望审核服务提供者认证申请，以便确保只有合格的提供者提供服务。

#### 验收标准

1. 平台应当为管理员用户提供认证审核界面
2. 认证界面应当显示所有待处理的认证请求及申请人信息
3. 当管理员查看认证请求时，平台应当显示申请人的个人资料和提交的凭证
4. 平台应当为每个认证请求提供批准和拒绝选项
5. 当管理员批准认证时，平台应当将普通用户角色升级为服务提供者
6. 当管理员拒绝认证时，平台应当向申请人发送包含拒绝原因的通知
7. 平台应当记录管理员决定和时间戳以供审计

### 需求14：管理员论坛管理

**用户故事：** 作为管理员，我希望管理论坛文章，以便维护内容质量并删除不当内容。

#### 验收标准

1. 平台应当为管理员用户提供论坛管理界面
2. 论坛界面应当显示所有已发布的文章及作者和发布时间
3. 平台应当允许管理员查看、编辑和删除任何文章
4. 当管理员删除文章时，平台应当删除该文章并向作者发送通知
5. 平台应当允许管理员推荐或置顶重要文章
6. 平台应当允许管理员按标题、作者或内容搜索文章
7. 平台应当记录所有管理员审核操作

### 需求15：管理员服务审批

**用户故事：** 作为管理员，我希望审核和批准服务列表，以便在服务对用户可用之前确保服务质量。

#### 验收标准

1. 平台应当为管理员用户提供服务审批界面
2. 审批界面应当显示所有待处理的服务列表及提供者信息
3. 当管理员查看待处理服务时，平台应当显示完整的服务详情
4. 平台应当为每个服务列表提供批准和拒绝选项
5. 当管理员批准服务时，平台应当将服务状态更改为活跃
6. 当管理员拒绝服务时，平台应当向服务提供者发送包含拒绝原因的通知
7. 平台应当记录管理员决定和时间戳以供审计

### 需求16：CSDN风格UI/UX实现

**用户故事：** 作为普通用户，我希望有一个熟悉且直观的界面，以便高效地浏览平台。

#### 验收标准

1. 平台应当实现遵循CSDN设计模式的导航布局
2. 平台应当在整个界面中使用一致的配色方案和排版
3. 平台应当显示顶部导航栏，其中包含指向主要部分的链接：文章、需求、服务、订单
4. 平台应当显示侧边栏，其中包含基于角色的用户特定链接
5. 平台应当实现支持桌面和移动视口的响应式设计
6. 当普通用户打开详情页时，平台应当将其显示为单独的覆盖层或模态视图
7. 详情页应当包含位于右上角的关闭按钮（X）
8. 当普通用户点击关闭按钮时，平台应当以平滑过渡关闭详情页

### 需求17：创作中心界面

**用户故事：** 作为普通用户，我希望有一个集中的创作界面，以便轻松发布不同类型的内容。

#### 验收标准

1. 平台应当提供可从主导航访问的创作中心
2. 创作中心应当显示三个部分：文章、需求和服务
3. 当用户具有服务提供者角色时，创作中心应当显示所有三个部分
4. 当用户仅具有普通用户角色时，创作中心应当显示文章和需求部分
5. 当普通用户点击某个部分时，平台应当显示相应的创建表单
6. 平台应当在所有内容类型中提供一致的表单布局
7. 平台应当在允许提交之前验证所有必填字段
8. 当普通用户提交内容时，平台应当显示成功消息并重定向到内容列表

### 需求18：交易管理

**用户故事：** 作为普通用户，我希望管理我的交易，以便跟踪我的购买和销售。

#### 验收标准

1. 平台应当为所有用户提供交易管理界面
2. 当用户是买家时，平台应当显示该用户作为买家的所有订单
3. 当用户是服务提供者时，平台应当显示该用户作为提供者的所有订单
4. 交易界面应当显示订单状态、金额、日期和交易对方信息
5. 平台应当允许按状态、日期范围和金额过滤交易
6. 当普通用户点击交易时，平台应当在详情页中显示完整的订单详情
7. 平台应当计算并显示交易总额和统计数据

### 需求19：个人信息管理

**用户故事：** 作为普通用户，我希望管理我的个人信息，以便保持我的个人资料最新。

#### 验收标准

1. 平台应当提供可从用户设置访问的个人信息界面
2. 个人信息界面应当显示可编辑字段：用户名、电子邮件、电话、头像、简介
3. 当普通用户更新个人信息时，平台应当验证输入数据
4. 平台应当防止重复的用户名和电子邮件地址
5. 当普通用户更改电子邮件时，平台应当向新地址发送验证电子邮件
6. 平台应当在更新电子邮件地址之前要求电子邮件验证
7. 平台应当允许普通用户通过当前密码验证来更改密码
8. 平台应当记录所有个人资料更改及时间戳

### 需求20：系统设置

**用户故事：** 作为普通用户，我希望配置系统设置，以便自定义我的平台体验。

#### 验收标准

1. 平台应当提供可从用户菜单访问的系统设置界面
2. 设置界面应当为每种通知类型提供通知偏好设置
3. 平台应当允许普通用户启用或禁用电子邮件通知
4. 平台应当允许普通用户启用或禁用应用内通知
5. 平台应当提供语言选择选项
6. 平台应当提供主题选择选项（浅色模式、深色模式）
7. 当普通用户更改设置时，平台应当立即应用更改
8. 平台应当在会话之间保持用户设置

### 需求21：内容搜索和发现

**用户故事：** 作为普通用户，我希望搜索和发现内容，以便找到相关的文章、需求和服务。

#### 验收标准

1. 平台应当提供可从主导航访问的搜索界面
2. 平台应当支持跨文章、需求和服务的搜索
3. 当普通用户输入搜索查询时，平台应当返回标题或内容中与查询匹配的结果
4. 平台应当按内容类型分组显示搜索结果
5. 平台应当提供内容类型、日期范围和类别的过滤选项
6. 平台应当支持按相关性、日期或热度对结果进行排序
7. 当普通用户点击搜索结果时，平台应当导航到相应的详情页
8. 平台应当在用户输入时显示搜索建议

### 需求22：数据验证和错误处理

**用户故事：** 作为开发人员，我希望有全面的数据验证和错误处理，以便平台保持稳定和安全。

#### 验收标准

1. 当普通用户提交表单时，平台应当在处理之前验证所有输入字段
2. 如果验证失败，则平台应当为每个无效字段显示具体的错误消息
3. 平台应当清理所有用户输入以防止XSS和SQL注入攻击
4. 当服务器错误发生时，平台应当显示用户友好的错误消息
5. 平台应当记录所有错误及堆栈跟踪以供调试
6. 如果网络请求失败，则平台应当最多重试该请求三次
7. 平台应当实施速率限制以防止滥用
8. 当超过速率限制时，平台应当返回包含重试时间的错误消息

### 需求23：会话管理和安全

**用户故事：** 作为普通用户，我希望有安全的会话管理，以便我的账户保持受保护状态。

#### 验收标准

1. 当普通用户登录时，平台应当创建具有过期时间的安全会话
2. 平台应当使用仅HTTP的cookie进行会话管理
3. 当会话过期时，平台应当将普通用户重定向到登录页面
4. 平台应当为所有状态更改操作实施CSRF保护
5. 当普通用户注销时，平台应当立即使会话无效
6. 平台应当检测并防止来自不同位置的并发会话
7. 如果检测到可疑活动，则平台应当要求额外的身份验证
8. 平台应当强制执行密码复杂性要求：至少8个字符，至少一个大写字母、一个小写字母、一个数字

### 需求24：性能和可扩展性

**用户故事：** 作为平台运营者，我希望系统在负载下高效运行，以便用户获得响应迅速的体验。

#### 验收标准

1. 当普通用户请求页面时，平台应当在正常负载下2秒内响应
2. 平台应当为所有列表视图实施分页，每页最多20个项目
3. 平台应当为图像和重型内容实施延迟加载
4. 平台应当使用适当的TTL值缓存频繁访问的数据
5. 当执行数据库查询时，平台应当使用索引字段进行过滤和排序
6. 平台应当为数据库连接实施连接池
7. 平台应当使用gzip压缩API响应
8. 平台应当支持至少1000个并发用户而不会出现性能下降

### 需求25：审计日志和合规性

**用户故事：** 作为平台管理员，我希望有全面的审计日志，以便跟踪系统活动并确保合规性。

#### 验收标准

1. 平台应当记录所有用户身份验证事件及时间戳和IP地址
2. 平台应当记录所有管理员操作及操作者、操作类型、目标和时间戳
3. 平台应当记录所有订单交易及完整的交易详情
4. 平台应当记录所有申诉提交和解决
5. 平台应当至少保留审计日志90天
6. 平台应当为管理员用户提供审计日志查看器
7. 平台应当允许按用户、操作类型和日期范围过滤审计日志
8. 平台应当保护审计日志免受修改或删除

## 基于属性测试的正确性属性

### 属性1：往返序列化
对于所有有效的数据对象（文章、需求、服务、订单、申诉），序列化为JSON并反序列化回来应当产生等效的对象。

### 属性2：角色权限不变性
对于所有用户和资源，如果用户缺少资源所需的角色，则无论请求方法或参数如何，访问应当被拒绝。

### 属性3：订单状态机不变性
对于所有订单，状态转换应当遵循有效的状态机：待处理 → 进行中 → （已完成 或 已失败）。无效的转换应当被拒绝。

### 属性4：申诉唯一性不变性
对于所有订单，最多应当存在一个申诉。尝试为同一订单创建第二个申诉应当失败。

### 属性5：幂等收藏
对于所有普通用户和文章，多次将文章添加到收藏应当产生与添加一次相同的状态。

### 属性6：搜索结果一致性
对于所有搜索查询，所有内容类型的结果并集应当仅包含与查询词匹配的项目。

### 属性7：通知传递保证
对于所有触发通知的事件，应当为每个相关用户创建恰好一个通知。

### 属性8：交易金额不变性
对于所有订单，记录的交易金额应当等于订单创建时的服务价格，并应当保持不可变。

### 属性9：审计日志完整性
对于所有管理员操作，应当创建恰好一个包含完整操作详情的审计日志条目。

### 属性10：会话过期一致性
对于所有过期的会话，使用过期会话的任何请求应当被拒绝并重定向到登录页面。

### 属性11：内容所有权不变性
对于所有内容项（文章、需求、服务），创建者应当保持为所有者并应当具有编辑权限，而其他用户应当具有只读访问权限。

### 属性12：分页一致性
对于所有分页列表，所有页面的并集应当等于完整的结果集，不存在重复或遗漏。
